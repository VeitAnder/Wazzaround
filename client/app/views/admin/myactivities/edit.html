<div ng-controller="AdminMyactivitiesEditCtrl">
  <h2>{{'Account' | translate}}</h2>

  <h3>
    <span ng-show="activity.name">{{'Activity' | translate}}: {{activity.name | languageselect}}</span>
    <span ng-show="!activity.name">{{'New activity' | translate}}</span>
  </h3>

  <form name="valForm"
        class="activity-edit"
        novalidate
      >

    <fieldset>
      <legend>{{'Global Activity Info' | translate}}:</legend>
      <div class="form-group">
        <label for="activityname">{{'Name of Activity or Activities' | translate}}</label>
        <input type="text"
               class="form-control"
               id="activityname"
               name="activityname"
               placeholder="i.e. Quad Tours (250ccm, 550ccm, 750ccm)"
               ng-model="activity.name[getInputLanguage()]"
               required
            >
        <span ng-show="showError('activityname', 'required')"
              class="alert">{{'Please enter the name of the activity/activities.' | translate}}
        </span>

      </div>

      <div class="form-group">
        <label for="company">{{'Company offering this activity' | translate}}</label>
        <input type="text"
               class="form-control"
               id="company"
               name="company"
               placeholder="{{'Enter company' | translate}}"
               ng-model="activity.company"
               required
            >

        <span ng-show="showError('company', 'required')"
              class="alert">{{'Please enter the name of your company.' | translate}}
        </span>
      </div>

      <div class="form-group">
        <label for="address">{{'Meeting spot of this activity' | translate}}</label>
        <input type="text"
               class="form-control"
               id="address"
               name="address"
               placeholder="{{'Enter address of meeting spot' | translate}}"
               ng-model="activity.address"
               ng-options="address.formatted_address as address.formatted_address for address in getAddress($viewValue)"
               bs-typeahead
               required
               ng-blur="setAddressOnMap()"
            >

        <span ng-show="showError('address', 'required')"
              class="alert">{{'Please select a location.' | translate}}
        </span>

      </div>

      <div style="width:100%; height:400px; overflow:hidden; position:relative;">

        <google-map
            center='map.center'
            zoom='map.zoom'
            draggable='true'
            events='map.events'
            options='map.options'
            >

          <!--marker for clicked position can not put google.map.animations.BOUNCE , since it is not initialized yet-->
          <div ng-init="opts = {animation:0}">
            <marker coords="map.clickedMarker"
                    options="opts"
                    icon='getMarkerIcon()'
                    content="activity.name[getAvailableTranslationLanguageKey(activity.name)]"
                >
            </marker>
            <!--<marker-label content="getMarkerLabel()"-->
            <!--anchor="44 0"-->
            <!--class="marker-labels"-->
            <!--/>-->
          </div>

        </google-map>

      </div>
      <div class="alert alert-info"
          >{{'Click in map to reposition location of activity' | translate}}</div>

      <div class="form-group">
        <label for="categoryMain">{{'Main Category' | translate}}</label>
        <select class="form-control"
                id="categoryMain"
                name="categoryMain"
                ng-model="activity.category.main"
                ng-change="mainCategoryChanged()"
                required
            >
          <option disabled="disabled">{{'Select Main Category' | translate}}</option>
          <option
              ng-repeat="category in categories"
              value="{{category.key}}"
              ng-selected="activity.category.main === category.key"
              >
            {{category.key | translate}}
          </option>
        </select>

        <span ng-show="showError('categoryMain', 'required')"
              class="alert">{{'Please select a category.' | translate}}
        </span>

      </div>

      <div class="form-group"
           data-ng-show="activity.category.main"
          >
        <div class="input_label">{{'Sub Category' | translate}}</div>

        <div
            class="checkbox"
            ng-repeat="subcategory in getSubCategories()"
            >
          <label>{{subcategory.key | translate}}
            <input type="checkbox"
                   ng-model="value$index"
                   data-ng-change="setSubcat(subcategory.key)"
                   ng-true-value="{{subcategory.key}}"
                   ng-false-value=""
                   ng-checked="isKeyInSubcats(subcategory.key)"
                   ng-disabled="!isKeyInSubcats(subcategory.key) && activity.category.subs.length >= 2"
                />
          </label>
        </div>

        <span class="alert alert-info"
              data-ng-show="activity.category.subs.length >= 2">{{'You can choose 2 Subcategories at most' |
                                                                translate}}!
        </span>
        <span class="alert alert-warn"
              data-ng-show="activity.category.subs.length === 0">{{'You must choose at least 1 Subcategory' | translate
                                                                 }}!
        </span>

      </div>

      <div class="form-group">
        <label>{{'Description' | translate}}</label>
        <text-angular
            ta-toolbar="[['h6', 'p', 'bold','italics','underline', 'ul', 'undo', 'redo']]"
            ng-model="activity.description[getInputLanguage()]"
            name="description"
            ng-required="true"
            >
        </text-angular>

        <span ng-show="showError('description', 'required')"
              class="alert">{{'Please enter a description.' | translate}}
        </span>

      </div>

      <imageselector class="form-group img-selector">
        <label>{{'Images' | translate}}</label>
        <imageblock class="img-block"
                    data-ng-repeat="image in activity.images"
            >
          <cloudinaryimage data-publicid="{{image.public_id}}"
                           data-format="{{image.format}}"
                           data-width="150"
                           data-height="150"
              >
          </cloudinaryimage>
          <div class="img-edit">
            <a class="delete"
               ng-click="removeImage(image, $index)">
              <span>{{'delete' | translate}}</span>
            </a>
          </div>
        </imageblock>
        <uploadform data-images="activity.images"></uploadform>
      </imageselector>

      <span ng-show="!state.additionalformchecks.images"
            class="alert">{{'Please upload an image.' | translate}}
      </span>

      <!--
         <dropzoneexampleforstylingpreview class="dropzone">
           <div class="dz-preview dz-file-preview dz-processing">
             <div class="dz-details">
               <div class="dz-filename">
                 <span data-dz-name="">_50MB.zip</span>
               </div>
               <div class="dz-size"
                    data-dz-size="">
                 <strong>46.4</strong>
                 MiB
               </div>
               <img data-dz-thumbnail="">
             </div>
             <div class="dz-progress">
               <span class="dz-upload"
                     data-dz-uploadprogress=""
                     style="width: 26.36409689099568%;"></span>
             </div>
             <div class="dz-success-mark">
               <span>✔</span>
             </div>
             <div class="dz-error-mark">
               <span>✘</span>
             </div>
             <div class="dz-error-message">
               <span data-dz-errormessage=""></span>
             </div>
             <a class="dz-remove"
                href="javascript:undefined;"
                data-dz-remove="">Cancel upload
             </a>
           </div>

           <div class="dz-preview dz-file-preview dz-processing">
             <div class="dz-details">
               <div class="dz-filename">
                 <span data-dz-name="">_50MB.zip</span>
               </div>
               <div class="dz-size"
                    data-dz-size="">
                 <strong>46.4</strong>
                 MiB
               </div>
               <img data-dz-thumbnail="">
             </div>
             <div class="dz-progress">
               <span class="dz-upload"
                     data-dz-uploadprogress=""
                     style="width: 26.36409689099568%;"></span>
             </div>
             <div class="dz-success-mark">
               <span>✔</span>
             </div>
             <div class="dz-error-mark">
               <span>✘</span>
             </div>
             <div class="dz-error-message">
               <span data-dz-errormessage=""></span>
             </div>
             <a class="dz-remove"
                href="javascript:undefined;"
                data-dz-remove="">Cancel upload
             </a>
           </div>


         </dropzoneexampleforstylingpreview>
        -->

    </fieldset>

    <fieldset>
      <legend>{{'What can be booked' | translate}}</legend>

      <!-- New Stuff -->
      <bookableitems class="bookableitems">

        <div class="bookableitem bookableitem-add"
             ng-repeat="(idx, bookableItem) in activity.bookableItems"
             ng-class="{deletemode: bookableItem.deletemode }"
            >

          <div class="bookableitem-header">

            <div class="buttonbar buttonbar-top">

              <a ng-click="bookableItem.deletemode = true"
                 ng-show="!bookableItem.deletemode"
                 class="txt-icon-delete">{{'Delete Item' | translate}}
                <span class="btn-icon-right"></span>
              </a>

              <div ng-show="bookableItem.deletemode">
                {{'Delete bookable item with all events?' | translate}}
                <a ng-click="removeItem(bookableItem.ref(), idx)"
                   class="btn btn-alert btn-mini space-left"
                    >{{'yes, delete' | translate}}
                </a>

                <a ng-click="bookableItem.deletemode = false"
                   class="btn btn-mini space-left"
                    >{{'no' | translate}}
                </a>

              </div>

            </div>

            <div class="bookableitem-name cell first">

              <label for="itemDescription">{{'Description' | translate}}</label>

              <input type="text"
                     class="form-control"
                     placeholder="{{'Bookable item description placeholder' | translate}}"
                     ng-model="bookableItem.ref().description[getInputLanguage()]"
                  >

            </div>

            <div class="bookableitem-duration cell last">
              <label for="itemDuration">{{'Duration' | translate}}</label>
              <input type="number"
                     class="form-control"
                     id="itemDuration"
                     placeholder="{{'Duration in hours' | translate}}"
                     ng-model="bookableItem.ref().duration"
                  >
            </div>

            <div class="bookableitem-price cell last">
              <label for="itemPrice">{{'Price' | translate}}</label>
              <input type="number"
                     class="form-control"
                     id="itemPrice"
                     placeholder="{{'Price in €' | translate}}"
                     ng-model="bookableItem.ref().price"
                  >
            </div>

          </div>

          <div class="bookableitem-body">

            <eventlistinlistedit class="event-list">

              <div class="event-header">
                <div class="event-date cell">{{'Date' | translate}}</div>
                <div class="event-time cell">{{'Time' | translate}}</div>
                <div class="event-quantity cell">{{'Qty' | translate}}</div>
                <div class="listaction cell">
                </div>
              </div>

              <eventrow class="event-row"
                        ng-repeat="(idx,event) in bookableItem.ref().events">

                <eventview ng-show="event.mode != 'edit' && event.mode != 'new'">
                  <div class="event-date cell">{{ event.ref().start | momentjs:{format: "ddd, MMM Do YY"} }}</div>
                  <div class="event-time cell">{{ event.ref().start | momentjs:{format: "h:mm a"} }}</div>
                  <div class="event-quantity cell">{{event.ref().quantity}}x</div>
                  <div class="listaction cell">
                    <a class="btn btn-mini btn-ordinary"
                       ng-click="event.mode = 'edit'">
                      <span>{{'edit' | translate}}</span>
                    </a>
                    <a class="btn btn-mini btn-alert btn-ordinary"
                       ng-click="removeEvent(bookableItem.ref(), idx)">
                      <span>{{'delete' | translate}}</span>
                    </a>
                  </div>
                </eventview>

                <eventedit class="eventedit"
                           ng-show="event.mode == 'edit' || event.mode == 'new'"
                    >
                  <div class="form-group date-from">
                    <input type="text"
                           size="10"
                           class="form-control"
                           ng-model="event.ref().start"
                           data-autoclose="0"
                           placeholder="{{'Date' | translate}}"
                           bs-datepicker>
                  </div>
                  <div class="form-group time">
                    <input type="text"
                           size="8"
                           class="form-control"
                           ng-model="event.ref().start"
                           data-autoclose="0"
                           placeholder="{{'Time' | translate}}"
                           bs-timepicker
                        >
                  </div>

                  <div class="form-group quantity">
                    <input type="number"
                           class="form-control"
                           id="quantity"
                           placeholder="{{'Quantity' | translate}}"
                           ng-model="event.ref().quantity"
                        >
                  </div>

                  <div class="event-new-repeat">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox"
                               ng-model="event.ref().repeating">
                        {{'repeating' | translate}}
                      </label>
                    </div>
                    <div class="repeating"
                         ng-show="event.ref().repeating">
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Mon">
                          {{'Mon' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Tue">
                          {{'Tue' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Wed">
                          {{'Wed' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Thu">
                          {{'Thu' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Fri">
                          {{'Fri' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Sat">
                          {{'Sat' | translate}}
                        </label>
                      </div>
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"
                                 ng-model="event.ref().dayOfWeek.Son">
                          {{'Sun' | translate}}
                        </label>
                      </div>

                      <div class="form-group date-until">
                        <input type="text"
                               class="form-control"
                               ng-model="event.ref().end"
                               data-min-date="today"
                               placeholder="{{'Until' | translate}}"
                               bs-datepicker
                               autoclose="true"
                               name="dateuntil"
                            >
                      </div>
                    </div>

                  </div>

                  <div class="buttonbar">
                    <a class="btn btn-small"
                       ng-click="event.mode = 'view'; createEventSeries(bookableItem.ref(), event.ref())"
                        >{{'save event' | translate}}
                    </a>

                    <!--<a ng-show="event.mode == 'edit'"-->
                    <!--ng-click="event.mode = 'view';"-->
                    <!--class="space-left">-->
                    <!--cancel-->
                    <!--</a>-->

                    <a ng-show="event.mode == 'new'"
                       ng-click="removeEvent(bookableItem.ref(), $index)"
                       class="space-left">
                      cancel
                    </a>

                  </div>

                </eventedit>

              </eventrow>

              <div class="event-add">
                <a class="txt-icon-add"
                   ng-click="createEvent(bookableItem.ref())">
                  <span class="btn-icon-left"></span>
                  {{'Add new Event' | translate}}
                </a>

              </div>

            </eventlistinlistedit>

            <!-- ######## STATIC LIST END ######## -->

          </div>
        </div>

        <button class="btn-add"
                ng-click="activity.createBookableItems()">
          <span class="btn-icon-left"></span>
          {{'create a bookable item' | translate}}
        </button>

        <span ng-show="!state.additionalformchecks.bookableevents"
              class="alert">{{'Please create bookable events.' | translate}}
        </span>

      </bookableitems>

    </fieldset>

    <div class="buttonbar margin-top">

      <div ng-show="state.error">
        <div class="alert alert-error">{{state.message | translate}}</div>
      </div>

      <a data-ng-show="!isNewMode()"
         class="btn btn-alert float-left"
         data-ng-click="delete()">{{'delete' | translate}}
      </a>

      <button class="btn"
              ng-click="save()"
              ng-class="{disabled: valForm.$invalid || !additionalFormChecks()}"
          >
        {{'save' | translate}}
      </button>
      <a class="cancel"
         ng-click="cancel()"
          >
        {{'cancel' | translate}}
      </a>

    </div>

  </form>

</div>
