<div class="map-selection-block">

  <div class="section section-map">

    <div class="col-left-fixed controlpanel">

      <languageselect></languageselect>

      <div data-ng-include="'views/_logo.html'"></div>

      <div class="mapsearchbar"
           data-ng-include="'views/map/mapsearchbar.html'">
      </div>

      <div class="filter">
        <span class="input-label">{{ 'Please choose' | translate }}:</span>

        <div class="filter-category filter-category-{{category.key}}"
             data-ng-class="{active: areItemsInThisCategorySelected(category), open: category.open }"
             ng-repeat="category in categories"
            >
          <div class="filter-category-header"
               data-ng-click="toggleFilter(category)"
              >
            <h4>{{category.key | translate}}</h4>

            <p>{{numberOfSelectedFromCategory(category)}} {{ 'activities found' | translate }} </p>

            <div class="filter-category-arrow">
              <span></span>
            </div>
          </div>
          <div class="filter-category-body"
               data-ng-show="category.open"
              >

            <div class="filter-toggle">
              <div class="filter-toggle-show"
                   data-ng-class="{active: allSelectedFromCategory(category)}"
                   data-ng-click="selectAllFromCategory(category)"
                  >
                {{ 'Select all' | translate }}
              </div>
              <div class="filter-toggle-hide"
                   data-ng-class="{active: noneSelectedFromCategory(category)}"
                   data-ng-click="deSelectAllFromCategory(category)"
                  >
                {{ 'Deselect all' | translate }}
              </div>
            </div>

            <div
                class="innerwrap"
                >
              <div
                  class="div-row"
                  ng-repeat="subcategory in category.sub"
                  >

                <!--show only in pairs - even-->
                <div data-ng-if="$index % 2 === 0">
                  <div
                      class="filter-category-sub div-cell"
                      ng-class="{selected: category.sub[$index+0].selected}"
                      ng-click="toggleCategorySelection(category.sub[$index+0])"
                      >
                    <span class="checkbox inline"></span>
                    {{ category.sub[$index+0].key | translate }}
                  </div>

                  <div
                      class="filter-category-sub div-cell"
                      data-ng-if="category.sub[$index+1]"
                      ng-class="{selected: category.sub[$index+1].selected}"
                      ng-click="toggleCategorySelection(category.sub[$index+1])"
                      >
                    <span class="checkbox inline"></span>
                    {{ category.sub[$index+1].key | translate }}
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
      </div>


      <div class="filter-toggle">
        <div class="filter-toggle-show"
             data-ng-class="{active: allSelected()}"
             data-ng-click="selectAllCategories()"
            >{{ 'Show all' | translate }}
        </div>
        <div class="filter-toggle-hide"
             data-ng-class="{active: noneSelected()}"
             data-ng-click="deSelectAllCategories()"
            >{{ 'Hide all' | translate }}
        </div>
      </div>

    </div>

    <div class="map-wrap">

      <google-map
          center='map.center'
          zoom='map.zoom'
          draggable='true'
          events='map.events'
          options='map.options'
          >
        <marker
            ng-repeat="m in map.markers | filter:selectedCategoryFilter | markercoordsfilter track by m._id"
            coords='m'
            click='onMarkerClicked(m)'
            options='markerOptions'
            icon='getMarkerIcon(m)'
            >

          <window
              show="m.showWindow"
              closeClick="m.closeClick()"
              options="windowOptions"
              >

            <div
                class="window-category-{{m.category.main}}"
                >
              <h4>
                <span class="icon"></span>
                {{m.name | languageselect}}
              </h4>

              <div class="img-block img-block-right">
                <cloudinaryimage ng-show="m.images.length > 0"
                                 data-publicid="{{m.images[0].public_id}}"
                                 data-format="{{m.images[0].format}}"
                                 data-width="100"
                                 data-height="60"
                    >
                </cloudinaryimage>
              </div>

              <div class="input-label">{{ 'Offered by' | translate }}</div>
              <h5 class="no-margin-top">{{m.company}}</h5>

              <div class="description">
                <!--<div class="input-label">Description</div>-->
                <div ta-bind
                     ng-model="m.description[getAvailableTranslationLanguageKey(m.description)]"></div>
              </div>

              <div class="availability">
                <div class="input-label">{{ 'Availability' | translate }}</div>
                <div class="availability-list">
                  <div class="availability-header">
                    <div class="month cell">{{ 'Next available Dates' | translate }}</div>
                  </div>
                  <div class="availability-entry"
                       ng-repeat="available in m.availability">
                    <div class="availability-title cell">
                      {{available.title | languageselect}}
                    </div>
                    <div class="availability-date cell">
                      {{ available.start | momentjs:{format: "DD. MMM YY"} }}
                    </div>
                    <div class="availability-time cell">
                      {{ available.start | momentjs:{format: "hh:mm a"} }}
                    </div>
                    <div class="availability-duration cell">
                      {{ available.duration | momentjs:{format: "h"} }}h
                    </div>
                    <div class="availability-quantity cell">
                      {{available.quantity}}x
                    </div>

                    <div class="availability-book cell align-right">
                      <a class="btn btn-mini btn-shoppingcart"
                         href="#/shoppingcart/"
                         target="_blank"
                         title="{{ 'Book' | translate }}"
                         ng-click="putIntoShoppingCart(m, available)"
                          >
                        <span>{{ 'Book' | translate }}</span>
                      </a>
                    </div>
                  </div>

                  <div class="availability-footer">
                    <div class="cell first">
                      <a class="btn btn-mini disabled"
                         ng-click=""
                          >{{ 'Prev' | translate }}
                      </a>
                    </div>
                    <div class="cell align-center">
                      <a class="btn btn-mini"
                         ng-click=""
                         href="#/activities/{{m._id}}/"
                          >{{ 'Show all Dates' | translate }}
                      </a>
                    </div>
                    <div class="cell last align-right">
                      <a class="btn btn-mini"
                         ng-click=""
                          >{{ 'Next' | translate }}
                      </a>
                    </div>
                  </div>

                </div>
              </div>

            </div>

          </window>
          <marker-label content="m.name[getAvailableTranslationLanguageKey(m.name)]"
                        anchor="22 0"
                        class="marker-labels marker-label-category-{{m.category.main}}"
              />
        </marker>

        <!--marker for clicked position can not put google.map.animations.BOUNCE , since it is not initiaized yet-->
        <div ng-init="opts = {animation:0}">
          <marker coords="map.centerMarker"
                  options="opts">
            <marker-label content="map.centerMarker.title | translate"
                          anchor="22 0"
                          class="marker-labels marker-labels-your-location"
                />
          </marker>
        </div>

      </google-map>

    </div>

    <div class="map-debug">
      <strong>Map-Debug:</strong>
      <br/>
      <u>Map ZOOM:</u>
      {{ map.zoom }}
      <br/>
      <u>You clicked here:</u>
      <br/>
      "longitude": {{ map.clickedMarker.longitude }}
      <br/>
      "latitude": {{ map.clickedMarker.latitude }}
    </div>

  </div>

  <shoppingcart
      data-ng-include="'views/directives/shoppingcart.html'"
      ng-class="{active: shoppingcart}"
      class="shoppingcart-rightside">
  </shoppingcart>

</div>

<div data-ng-include="'views/_footer.html'"
     class="footer footer-startpage"></div>


