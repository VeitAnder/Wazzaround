<div class="map-selection-block">

  <div class="section section-map">

    <div class="col-left-fixed controlpanel">

      <languageselect></languageselect>

      <div data-ng-include="'views/_logo.html'"></div>

      <div class="mapsearchbar"
           data-ng-include="'views/map/mapsearchbar.html'">
      </div>

      <div class="filter">
        <span class="input-label">{{ 'Please choose' | translate }}:</span>

        <div class="filter-category filter-category-{{category.key}}"
             data-ng-class="{active: areItemsInThisCategorySelected(category), open: category.open }"
             ng-repeat="category in categories"
            >
          <div class="filter-category-header"
               data-ng-click="toggleFilter(category)"
              >
            <h4>{{category.key | translate}}</h4>

            <p>{{numberOfSelectedFromCategory(category)}} {{ 'activities found' | translate }} </p>

            <div class="filter-category-arrow">
              <span></span>
            </div>
          </div>
          <div class="filter-category-body"
               data-ng-show="category.open"
              >

            <div class="filter-toggle">
              <div class="filter-toggle-show"
                   data-ng-class="{active: allSelectedFromCategory(category)}"
                   data-ng-click="selectAllFromCategory(category)"
                  >
                {{ 'Select all' | translate }}
              </div>
              <div class="filter-toggle-hide"
                   data-ng-class="{active: noneSelectedFromCategory(category)}"
                   data-ng-click="deSelectAllFromCategory(category)"
                  >
                {{ 'Deselect all' | translate }}
              </div>
            </div>

            <div
                class="innerwrap"
                >
              <div
                  class="div-row"
                  ng-repeat="subcategory in category.sub"
                  >

                <!--show only in pairs - even-->
                <div data-ng-if="$index % 2 === 0">
                  <div
                      class="filter-category-sub div-cell"
                      ng-class="{selected: category.sub[$index+0].selected}"
                      ng-click="toggleCategorySelection(category.sub[$index+0])"
                      >
                    <span class="checkbox inline"></span>
                    {{ category.sub[$index+0].key | translate }}
                  </div>

                  <div
                      class="filter-category-sub div-cell"
                      data-ng-if="category.sub[$index+1]"
                      ng-class="{selected: category.sub[$index+1].selected}"
                      ng-click="toggleCategorySelection(category.sub[$index+1])"
                      >
                    <span class="checkbox inline"></span>
                    {{ category.sub[$index+1].key | translate }}
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="filter-toggle">
        <div class="filter-toggle-show"
             data-ng-class="{active: allSelected()}"
             data-ng-click="selectAllCategories()"
            >{{ 'Show all' | translate }}
        </div>
        <div class="filter-toggle-hide"
             data-ng-class="{active: noneSelected()}"
             data-ng-click="deSelectAllCategories()"
            >{{ 'Hide all' | translate }}
        </div>
      </div>

    </div>

    <div class="map-wrap">
      <div class="map-innerwrap">

        <google-map
            center='frontendmap.map.center'
            zoom='frontendmap.map.zoom'
            draggable='true'
            events='frontendmap.map.events'
            options='frontendmap.map.options'
            >
          <marker
              ng-repeat="m in states.filteredactivities = (frontendmap.map.markers | filter:selectedCategoryFilter | adddistancetosearchlocation | orderBy:'distancetosearchlocation' | markercoordsfilter) track by m._id"
              coords='m'
              click='onMarkerClicked(m)'
              options='markerOptions'
              icon='getMarkerIcon(m)'
              >

            <!-- <window
                 show="m.showWindow"
                 closeClick="m.closeClick()"
                 options="windowOptions"
                 >

               <div
                   class="window-category-{{m.category.main}}"
                   >
                 <h4>
                   <span class="icon"></span>
                   {{m.name | languageselect}}
                 </h4>

                 <div class="img-block img-block-right">
                   <cloudinaryimage ng-show="m.images.length > 0"
                                    data-publicid="{{m.images[0].public_id}}"
                                    data-format="{{m.images[0].format}}"
                                    data-width="100"
                                    data-height="60"
                       >
                   </cloudinaryimage>
                 </div>

                 <div class="input-label">{{ 'Offered by' | translate }}</div>
                 <h5 class="no-margin-top">{{m.company}}</h5>

                 <div class="description">
                   <div class="input-label">Description</div>
                   <div ta-bind
                        ng-model="m.description[getAvailableTranslationLanguageKey(m.description)]"></div>
                 </div>

                 <div class="availability">
                   <div class="input-label">{{ 'Availability' | translate }}</div>
                   <div class="availability-list">
                     <div class="availability-header">
                       <div class="month cell">{{ 'Next available Dates' | translate }}</div>
                     </div>

                     <bookableitemlist data-activity="m">
                     </bookableitemlist>

                   </div>
                 </div>

               </div>

             </window>-->

            <marker-label content="m.name[getAvailableTranslationLanguageKey(m.name)]"
                          anchor="22 0"
                          class="marker-labels marker-label-category-{{m.category.main}}"
                />
          </marker>

          <!--marker for clicked position can not put google.frontendmap.map.animations.BOUNCE , since it is not initialized yet-->
          <div ng-init="opts = {animation:0}">
            <marker coords="frontendmap.map.centerMarker"
                    options="opts">
              <marker-label content="frontendmap.map.centerMarker.title | translate"
                            anchor="22 0"
                            class="marker-labels marker-labels-your-location"
                  />
            </marker>
          </div>

        </google-map>

      </div>
      <!-- map-innerwrap-->

      <activitybardetail
          ajs-centermaxwith
          class="detail-category-{{getSelectedActivity().category.main}}"
          ng-class="{activitydetailactive: states.activitydetailactive}"
          ng-show="states.filteredactivities.length > 0"
          >

        <div class="txt-icon-delete"
             ng-click="states.activitydetailactive = false">
          <span class="hidden">Close detail view</span>
          <span></span>
        </div>

        <h4>
          {{getSelectedActivity().name | languageselect}}
        </h4>
        <h6 class="no-margin-top">
          {{'Offered by' | translate}} {{activity.company}}
        </h6>

        <div ta-bind
             class="description"
             ng-model="getSelectedActivity().description[getAvailableTranslationLanguageKey(getSelectedActivity().description)]">
        </div>

        <div class="availability">
          <div class="input-label">{{'Availability' | translate}}</div>

          <bookableitemlist
              data-activity="getSelectedActivity()"
              showpagination="true"
              limit="3"
              >
          </bookableitemlist>

        </div>

      </activitybardetail>

      <activitybar
          ng-if="states.filteredactivities.length === 0"
          >
        <div class="activitybar-noresult">
          <span class="icon"></span>
          <h4>{{'No Activities found.' | translate}}</h4>

          <p>{{'Zoom out the map or reset your filter settings.' | translate}}</p>
        </div>
      </activitybar>

      <!--use ng-if to avoid data binding error messages when getSelectedActivity() returns undefined in case of empty states.filteredactivities -->
      <activitybar
          ng-if="getSelectedActivity()"
          >

        <activitybarstripe>

          <currentactivity
              ajs-centermaxwith
              ng-class="{activitydetailactive: states.activitydetailactive}"
              >

            <div class="activity-detail-toggle"
                 ng-click="toggleCurrentActivity()"
                >
              {{'Info & Booking' | translate}}
            </div>

            <div ng-show="states.filteredactivities.length > 0">

              <div class="currentactivity-body category-{{getSelectedActivity().category.main}}"
                   ng-click="toggleCurrentActivity()"
                  >
                <cloudinaryimage
                    data-publicid="{{getSelectedActivity().images[0].public_id}}"
                    data-format="{{getSelectedActivity().images[0].format}}"
                    data-width="650"
                    data-height="200"
                    >
                </cloudinaryimage>

                <div class="activity-distance-element">
                  <span class="current-location"></span>
                  <span class="activity-distance-txt">
                    {{getSelectedActivity().distancetosearchlocation | mtokm }} km |
                    {{getIndexFilteredActivities(getSelectedActivity()) }} {{'of' | translate }}
                    {{states.filteredactivities.length}}
                  </span>
                  <span class="activity-location"></span>
                </div>

                <div class="activity-text">
                  <h5 class="category">
                    {{getSelectedActivity().category.main | translate}}
                    <span class="category-sub"
                          ng-repeat="subcat in getSelectedActivity().category.subs">
                      / {{subcat.key | translate}}
                    </span>
                  </h5>

                  <h4>{{getSelectedActivity().name | languageselect}}</h4>

                  <p ta-bind
                     ng-model="getSelectedActivity().description[getAvailableTranslationLanguageKey(getSelectedActivity().description)]"
                      >
                  </p>

                </div>
                <div class="activity-price-min">
                  <span class="smalltext">{{'starting from' | translate }}</span>
                  <span class="price">€ 135</span>
                </div>

                <span class="triangle"></span>
              </div>

              <a ng-click="selectprev()"
                 class="activitybar-item-prev"
                  >
                <div class="activity-nav activity-nav-prev">
                  <span class="hideme">previous activity</span>
                  <span></span>
                </div>
              </a>

              <a ng-click="selectnext()"
                 class="activitybar-item-next"
                  >
                <div class="activity-nav activity-nav-next">
                  <span class="hideme">next activity</span>
                  <span></span>
                </div>
              </a>

            </div>

            <div ng-show="states.filteredactivities.length === 0">
              keine Aktivität gefunden
            </div>

          </currentactivity>

        </activitybarstripe>

      </activitybar>

    </div>

    <div class="map-debug">
      <strong>Map-Debug:</strong>
      <br/>
      <u>Map ZOOM:</u>
      {{ frontendmap.map.zoom }}
      <br/>
      <u>You clicked here:</u>
      <br/>
      "longitude": {{ frontendmap.map.clickedMarker.longitude }}
      <br/>
      "latitude": {{ frontendmap.map.clickedMarker.latitude }}
    </div>

  </div>

  <shoppingcart class="shoppingcart-rightside">
  </shoppingcart>

</div>

<div data-ng-include="'views/_footer.html'"
     class="footer footer-startpage"></div>


